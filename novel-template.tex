% !TeX TS-program = lualatex
% !TeX encoding = UTF-8

% Copyright 2024 Pierre-Yves Martin.
% This file may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, version 1.3c.
% License URL:  https://www.latex-project.org/lppl/lppl-1-3c/

% EXAMPLE OF NOVEL DOCUMENT CLASS, using mostly default layout.
% IF YOU COMPILE THIS DOCUMENT: Be sure that this file, and its generated PDF,
%   have read/write permissions for any user. If they don't, then
%   compile will fail at the point where files are written.

% This is a pandoc/quarto template document (generating LaTeX document) and
% it respect the pandoc template syntax.
% See: https://pandoc.org/chunkedhtml-demo/6.1-template-syntax.html

% This file is partially based on the quarto LaTeX
% See: template https://github.com/quarto-dev/quarto-cli/blob/main/src/resources/formats/pdf/pandoc/template.tex

$-- class_options is a metadata generated by the novel_class_options filter according to various metadata values
\documentclass[$for(class_options)$$class_options$$sep$,$endfor$]{novel}

%%% FONT CONFIG FOR NATIVE EMOJI SUPPORT
% See: https://tex.stackexchange.com/a/572220 and in peticular the answers
\directlua{luaotfload.add_fallback
   ("emojiparentfallback",
    {
      "$fonts.parent.emoji_fallback$:",
      "$fonts.parent.berber_fallback$:",
    }
   )}

\directlua{luaotfload.add_fallback
   ("emojisansfallback",
    {
      "$fonts.sans.emoji_fallback$:",
      "$fonts.sans.berber_fallback$:"
    }
   )}

\directlua{luaotfload.add_fallback
   ("emojimonofallback",
    {
      "$fonts.mono.emoji_fallback$:",
      "$fonts.sans.berber_fallback$:"
    }
   )}

%%% GENERAL FONTS:
% Choose only Open Type or TrueType fonts, not the ancient Type 1 (PostScript) or Metafonts.
% The font you choose does not have to be part of any TeX package, because you do not need
% any *.sty file or TeX metrics. All of that is built into the font itself.
% This is thanks to LuaLaTeX and the built-in fontspec package.
%
% You do not write \usepackage{fontname}
% or \RequirePackage{fontname}
% or \setmainfont{fontname}.
% If you do that, then a warning or error will result, and in any case the font you get won't be the one you were expecting.
\SetParentFont[%
$fonts.parent.features$ %
RawFeature={fallback=emojiparentfallback} % This is to have emoji fallback
]{$fonts.parent.name$}
\SetFontSize{$fonts.parent.size$}

%%% SPECIFIC FONTS

% Custom fonts
\NewFontFamily\booktitlefont{$fonts.custom.title.name$}
\NewFontFamily\parttitlefont{$fonts.parttitle.name$}
\NewFontFamily\firstletterfont{$fonts.firstletter.name$}
\NewFontFamily\dropcapfont{$fonts.dropcap.name$}

% Standard fonts
\SetDecoFont{$fonts.deco.name$}

\SetDropCapFont{\dropcapfont}

\setsansfont[%
RawFeature={fallback=emojisansfallback}, % This is to have emoji fallback
Scale=$fonts.sans.scale$, %
]{$fonts.sans.name$}

\setmonofont[%
RawFeature={fallback=emojimonofallback}, % This is to have emoji fallback
Scale=$fonts.mono.scale$, %
]{$fonts.mono.name$}

\setmathfont{$fonts.math.name$}

\SetChapterFont[%
RawFeature={fallback=emojisansfallback}, % This is to have emoji fallback
Numbers=Lining, %
Scale=$fonts.chaptertitle.scale$ %
]{$fonts.chaptertitle.name$}

\SetSubchFont[
RawFeature={fallback=emojisansfallback}, % This is to have emoji fallback
Numbers=Lining,
Scale=$fonts.chaptersubtitle.scale$
]{$fonts.chaptersubtitle.name$}

%%% PAGE LAYOUT
\SetLinesPerPage{$page_layout.lines_per_page$}
\setlength{\parindent}{$page_layout.parindent$}
\setlength{\parskip}{$page_layout.parskip$}

%%% Commands to store the name of the current chapter, quickchapter and part
\newcommand{\thechapter}{}
\newcommand{\thequickchapter}{}
\newcommand{\thepart}{}

%%% GLOBAL PAGE HEADER/FOOTER
$-- headerfooter.raw_style is a metadata generated by the header_footer filter according to more readable headerfooter.style metadata
\SetHeadFootStyle{$headerfooter.raw_style$}

%%% GLOBAL CHAPTER CONFIG
\SetChapterStartStyle{$chapters.page_style$}

$-- draft_watermark is a metadata generated by the novel_class_options filter according to various metadata values
$if(draft_watermark)$
% Draft watermarking
% See: https://texblog.org/2012/02/17/watermarks-draft-review-approved-confidential/
\usepackage[firstpage]{draftwatermark}
$endif$

% To have clean support of text alignment
% See: https://www.overleaf.com/learn/latex/Text_alignment
\usepackage{ragged2e}

% Novel class config
\SetChapterStartHeight{$chapters.header_height$}  % https://ctan.math.illinois.edu/macros/luatex/latex/novel/doc/novel-documentation.html#h5.1.2.2
\SetMarkerStyle{number}  % https://ctan.math.illinois.edu/macros/luatex/latex/novel/doc/novel-documentation.html#h6.4.1
$if(scenebreaks.indent)$
\SetScenebreakIndent{true}
$endif$

% Quarto/pandoc config
$-- taken from https://github.com/quarto-dev/quarto-cli/blob/main/src/resources/formats/pdf/pandoc/latex.template
$if(strikeout)$
$-- also used for underline
\usepackage{luacolor}
\usepackage[soul]{lua-ul}
$endif$

$-- taken from https://github.com/quarto-dev/quarto-cli/blob/main/src/resources/formats/pdf/pandoc/template.tex
$if(links-as-notes)$
% Make links footnotes instead of hotlinks:
\DeclareRobustCommand{\href}[2]{#2\footnote{\url{#1}}}
$endif$

$-- taken from https://github.com/quarto-dev/quarto-cli/blob/main/src/resources/formats/pdf/pandoc/pandoc.tex
$tightlist.tex()$

% Metadata informations
\SetTitle{$title$}
\SetSubtitle{$subtitle$}
\SetAuthor{$author$}
\SetPDFX[CGATSTR001]{X-1a:2001}

\begin{document}

$body$

\end{document}
